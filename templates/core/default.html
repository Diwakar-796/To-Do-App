{% extends "core/base.html" %}
{% load static %}

{% block content %}
<div class="d-flex justify-content-center align-items-center" style="min-height: 100vh;">
    <div class="card shadow-lg p-3" style="width:100%; max-width: 600px;">
        <div class="card-body">
            <div class="d-flex justify-content-center align-items-center">
                <h3 class="text-center mb-4 text-light">To-Do List</h3>
                {% comment %} <div class="dropdown">
                     <button class="btn btn-secondary bg-transparent border-0 fs-5 mb-3" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                        <span>&#8942;</span> <!-- or &#x22EE; -->
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">

                        {% if user.is_authenticated %}
                        <li><a class="dropdown-item" href="{% url 'profile' %}">
                                <i class="bi bi-person-fill"></i>
                                &nbsp;Profile
                            </a>
                        </li>
                        {% else %}
                        <li><a class="dropdown-item" href="{% url 'sign-in' %}">
                                <i class="bi bi-box-arrow-in-right"></i>
                                &nbsp;Sign-in
                            </a>
                        </li>
                        {% endif %}

                        <li><a class="dropdown-item" href="#">
                                <i class="bi bi-info-circle"></i>
                                &nbsp;About
                            </a>
                        </li>
                        <li><a class="dropdown-item" href="#">
                            <i class="bi bi-telephone-fill"></i>
                            &nbsp;Contact Us</a>
                        </li>
                        
                    </ul>
                </div>
                {% if user.is_authenticated %}
                <a href="{% url 'profile' %}" class="bg-transparent border-0 mb-3">
                    <i class="bi bi-person-circle fs-5 mb-5"></i>
                </a>
                {% else %}
                <a href="{% url 'sign-in' %}" class="text-light text-decoration-none mb-3">
                    <i class="bi bi-box-arrow-in-right fs-5"></i>
                </a>
                {% endif %} {% endcomment %}
            </div>

            <!-- Divider -->
            <hr class="my-4 border-light">

            <!-- Progress Section -->
            <div class="progress-box">
                <h6 class="text-center mb-4 text-light">Keep it up!</h6>
                <div class="progress">
                    <div class="progress-bar" style="width: 50%;"></div>
                </div>
                <br>
            </div>

            <!-- Add Task Input -->
            <form method="POST" action="" class="input-group mb-3">
                {% csrf_token %}
                <input type="text" name="add-task" class="form-control rounded-start" placeholder="Add a new task...">
                <button class="btn btn-primary" type="submit" id="add-task-btn">
                    <i class="bi bi-plus-lg"></i>
                </button>
            </form>

            <!-- Task list -->
            <ul class="list-group list-group-flush" id="todo-list">
                <li class="list-group-item bg-transparent text-light d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center flex-grow-1">

                        <!-- Done/Undone -->
                        <button type="submit" name="check" value="" class="btn bg-transparent rounded-circle">
                            <i class="bi bi-check-circle text-success"></i>
                        </button>

                        <!-- Task Label + Hidden Edit Input -->
                        <span class="task-label text-decoration-line-through flex-grow-1">Sample Task 1</span>
                        <input type="text" class="form-control edit-input d-none flex-grow-1" value="Sample Task 1">
                        
                        <!-- Hidden form for Django submission -->
                        <form action="" method="POST" class="edit-form d-none">
                            {% csrf_token %}
                            <input type="hidden" name="task_id" value="">
                            <input type="hidden" name="new-title">
                        </form>
                    </div>

                    <!-- Action Buttons -->
                    <div class="btn-group btn-group-sm">
                        <button type="button" class="btn btn-outline-primary edit-btn rounded" style="width: 42px; margin-right: 5px; margin-left: 5px;">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button type="button" class="btn btn-outline-success save-btn d-none rounded" style="width: 42px; margin-right: 5px; margin-left: 5px;">
                            <i class="bi bi-check"></i>
                        </button>

                        <form method="POST" action="">
                            {% csrf_token %}
                            <button type="submit" name="del-task" value="" class="btn btn-outline-danger delete-btn rounded">
                                <i class="bi bi-trash"></i>
                            </button>
                        </form>
                    </div>
                </li>

                <li class="list-group-item bg-transparent text-light d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center flex-grow-1">

                        <!-- Done/Undone -->
                        <button type="submit" name="check" value="" class="btn bg-transparent rounded-circle">
                            <i class="bi bi-x-circle text-danger"></i>
                        </button>

                        <!-- Task Label + Hidden Edit Input -->
                        <span class="task-label flex-grow-1">Sample Task 2</span>
                        <input type="text" class="form-control edit-input d-none flex-grow-1" value="Sample Task 2">
                        
                        <!-- Hidden form for Django submission -->
                        <form action="" method="POST" class="edit-form d-none">
                            {% csrf_token %}
                            <input type="hidden" name="task_id" value="">
                            <input type="hidden" name="new-title">
                        </form>
                    </div>

                    <!-- Action Buttons -->
                    <div class="btn-group btn-group-sm">
                        <button type="button" class="btn btn-outline-primary edit-btn rounded" style="width: 42px; margin-right: 5px; margin-left: 5px;">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button type="button" class="btn btn-outline-success save-btn d-none rounded" style="width: 42px; margin-right: 5px; margin-left: 5px;">
                            <i class="bi bi-check"></i>
                        </button>

                        <form method="POST" action="">
                            {% csrf_token %}
                            <button type="submit" name="del-task" value="" class="btn btn-outline-danger delete-btn rounded">
                                <i class="bi bi-trash"></i>
                            </button>
                        </form>
                    </div>
                </li>

                 <li class="list-group-item bg-transparent text-light d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center flex-grow-1">

                        <!-- Done/Undone -->
                        <button type="submit" name="check" value="" class="btn bg-transparent rounded-circle">
                            <i class="bi bi-x-circle text-danger"></i>
                        </button>

                        <!-- Task Label + Hidden Edit Input -->
                        <span class="task-label flex-grow-1">Sample Task 3</span>
                        <input type="text" class="form-control edit-input d-none flex-grow-1" value="Sample Task 3">
                        
                        <!-- Hidden form for Django submission -->
                        <form action="" method="POST" class="edit-form d-none">
                            {% csrf_token %}
                            <input type="hidden" name="task_id" value="">
                            <input type="hidden" name="new-title">
                        </form>
                    </div>

                    <!-- Action Buttons -->
                    <div class="btn-group btn-group-sm">
                        <button type="button" class="btn btn-outline-primary edit-btn rounded" style="width: 42px; margin-right: 5px; margin-left: 5px;">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button type="button" class="btn btn-outline-success save-btn d-none rounded" style="width: 42px; margin-right: 5px; margin-left: 5px;">
                            <i class="bi bi-check"></i>
                        </button>

                        <form method="POST" action="">
                            {% csrf_token %}
                            <button type="submit" name="del-task" value="" class="btn btn-outline-danger delete-btn rounded">
                                <i class="bi bi-trash"></i>
                            </button>
                        </form>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</div>

<!-- Inline JS for toggling edit/save -->
<script>
document.querySelectorAll(".edit-btn").forEach(btn => {
  btn.addEventListener("click", function() {
    const li = this.closest("li");
    li.querySelector(".task-label").classList.add("d-none");
    li.querySelector(".edit-input").classList.remove("d-none");
    li.querySelector(".save-btn").classList.remove("d-none");
    this.classList.add("d-none");
  });
});

document.querySelectorAll(".save-btn").forEach(btn => {
  btn.addEventListener("click", function() {
    const li = this.closest("li");
    const label = li.querySelector(".task-label");
    const input = li.querySelector(".edit-input");
    const editButton = li.querySelector(".edit-btn");
    const saveButton = li.querySelector(".save-btn");
    const form = li.querySelector(".edit-form");

    // Update text
    label.textContent = input.value.trim();

    // Toggle back
    input.classList.add("d-none");
    label.classList.remove("d-none");
    saveButton.classList.add("d-none");
    editButton.classList.remove("d-none");

    // Submit hidden form to Django
    form.querySelector("input[name='new-title']").value = input.value.trim();
    form.submit();
  });
});
</script>
{% endblock %}
